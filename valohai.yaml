- step:
    name: determine
    image: python:3.10
    command: python determine-epochs.py
- step:
    name: yolo
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command:
    - pip install debugpy
    - python train-model.py {parameters}
    parameters:
    - name: epochs
      default: 1
      optional: false
      type: integer
    - name: optimizer
      default: SGD
      optional: false
      type: string
    - name: debug
      default: false
      pass-false-as: --debug=0
      pass-true-as: --debug=1
      type: flag
    environment: valohai-dev-debug
- step:
    name: inference
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command: python inference.py
    inputs:
    - name: model
      optional: false
    - name: images
      default: https://ultralytics.com/images/bus.jpg
      optional: false
- step:
    name: test
    image: python:3.7
    command:
    - pip install -r requirements.txt
    - python ./inference.py {parameters}
- pipeline:
    name: training-inference-pipeline
    edges:
    - configuration: {}
      source: determine.metadata.epochs
      target: train.parameters.epochs
    - configuration: {}
      source: train.output.best.onnx
      target: inference.input.model
    nodes:
    - name: determine
      on-error: stop-all
      step: determine
      type: execution
    - name: train
      on-error: stop-all
      step: yolo
      type: task
    - name: inference
      on-error: stop-all
      step: inference
      type: execution
    parameters:
    - name: optimizer
      default: SGD
      targets:
      - train.parameters.optimizer
